***Mọi thắc mắc trong quá trình cài đặt xin vui lòng liên hệ NgocNN-HT***

# Wazuh

Wazuh là mội giải pháp HIDS mã nguồn mở, Wazuh khởi đầu từ một nhánh nhỏ của OSSEC, từ năm 2015 Wazuh tách ra khỏi ossec và phát triển độc lập. Wazuh kế thừa đầy đủ các tính năng của OSSEC như phân tích nhật ký, kiểm tra tính toàn vẹn của tệp, phát hiện rootkit,... ngoài ra Wazuh đã được cải tiến để nâng cao hiệu suất, luôn được cập nhật các mẫu chữ ký, các phương pháp phát hiện liên tục. [Wazuh form OSSEC](https://documentation.wazuh.com/current/migration-guide/migrating-from-ossec/)


## Bước 1: Cài đặt Wazuh agent 

### Cài đặt Wazuh Agent trên hệ điều hành Debian/Ubuntu

 - Cài đặt các gói bổ trợ :
```sh
apt-get install curl apt-transport-https lsb-release -y
```

 - Thêm Wazuh repo  :
```sh
curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | apt-key add -
```

 - Tìm tên của OS và thêm vào repo
```sh
echo "deb https://packages.wazuh.com/3.x/apt/ stable main" | tee /etc/apt/sources.list.d/wazuh.list
```

 - Update thông tin package
```sh
apt-get update -y
```

 - Install Wazuh agent
```sh
apt-get install wazuh-agent -y
```

### Cài đặt Wazuh Agent trên hệ điều hành CentOS

Thêm khóa :

```sh
rpm --import https://packages.wazuh.com/key/GPG-KEY-WAZUH
```
 - Cài Wazuh repo  :

```sh
cat > /etc/yum.repos.d/wazuh.repo << EOF
[wazuh]
gpgcheck=1
gpgkey=https://packages.wazuh.com/key/GPG-KEY-WAZUH
enabled=1
name=EL-\$releasever - Wazuh
baseurl=https://packages.wazuh.com/4.x/yum/
protect=1
EOF
```

 - Install Wazuh agent
```sh
yum install wazuh-agent
```

### Cài đặt Wazuh Agent trên hệ điều hành Windows

- Download package từ source trên trang chủ của SO:

[Wazuh agent Windows](https://drive.google.com/file/d/18YoOeSuKERiPNz6UbMeuVuTMLAOeXOZu/view?usp=sharing)

![Screenshot](/images/wazuh-agent-windows.png)

 - **Cách 1**: Sử dụng cmd để cài đặt:
```sh
wazuh-agent-3.6.1-1.msi /q
```

 - **Cách 2** : Sử dụng GUI : Double-click vào file dowload và cài đặt với mặc định. Một khi cài đặt xong, agent sẽ có giao diện đồ họa để cấu hình, mở log file hoặc start/stop service :

 
Mặc định tất cả file agent được đặt tại : `C:\Program Files(x86)\ossec-agent`

### Cài đặt Wazuh Agent trên hệ điều hành MacOS
**(todo)**

## Bước 2: Đăng ký Agent

Trong phần này sẽ hướng dẫn cách register để giám sát các agent :

**Trên Agent Windows** : 

- Mở **win32ui.exe** trong thử mục `C:\Program Files(x86)\ossec-agent`

- Nhập Địa chỉ IP Server: 192.168.90.28 và Key tương ứng trong file [VMG: Wazuh Agent key](https://docs.google.com/spreadsheets/d/1Q9SpbvxVlAs49JBKU641jm_1i8vjKqzL3dOcyaThlKY/edit?usp=sharing) 

<kbd>*Lưu ý: Name đúng với tên server thì mới chọn y, sai thì chọn n*<kbd>

- Start Agent

**Trên Agent Linux/Unix** : 

 - Chạy `manage_agents` : 
```sh
# /var/ossec/bin/manage_agents

****************************************
* Wazuh v3.2.1 Agent manager.            *
* The following options are available: *
****************************************
   (I)mport key from the server (I).
   (Q)uit.
Choose your action: I or Q:
```

 - Chọn `I` để import key, paste key tương ứng trong file [VMG: Wazuh Agent key](https://docs.google.com/spreadsheets/d/1Q9SpbvxVlAs49JBKU641jm_1i8vjKqzL3dOcyaThlKY/edit?usp=sharing) 

<kbd>*Lưu ý: Name đúng với tên server thì mới chọn y, sai thì chọn n*<kbd>
 
```sh
Choose your action: I or Q: I

* Provide the Key generated by the server.
* The best approach is to cut and paste it.
*** OBS: Do not include spaces or new lines.

Paste it here (or '\q' to quit): MDAxIDE4NWVlNjE1Y2YzYiBhbnkgMGNmMDFiYTM3NmMxY2JjNjU0NDAwYmFhZDY1ZWU1YjcyMGI2NDY3ODhkNGQzMjM5ZTdlNGVmNzQzMGFjMDA4Nw=

Agent information:
   ID:002
   Name:User1
   IP Address:any

Confirm adding it?(y/n): y
Added.
```

 - Ấn `Q` để thoát
 
 - Chỉnh sửa IP của server Manager (192.168.90.28) tại file `/var/ossec/etc/ossec.conf` : 
```sh
<client>
      <server-ip>MANAGE_IP</server-ip>
</client>
```

 - Restart lại agent :
```sh
# /var/ossec/bin/ossec-control restart
```

 - Khởi động agent :
```sh
#  systemctl enable wazuh-agent
#  systemctl start wazuh-agent
```
- Kiểm tra tiến trình wazuh-agnet
```sh
#  systemctl status wazuh-agent
```

